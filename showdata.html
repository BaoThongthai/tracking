<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Quản lý dữ liệu</title>
</head>

<body>
    <div class="container-flud mt-5 ml-2">
        <h1>Danh sách dữ liệu</h1>

        <div id="trackingTable"></div>

        <hr>

        <!-- Form sửa dữ liệu -->
        <div id="editForm" style="display: none;">
            <h2>Chỉnh sửa thông tin</h2>
            <form id="editTrackingForm">
                <input type="hidden" id="editItemId">
                <div class="form-group">
                    <label for="editTenCuahang">Tên cửa hàng</label>
                    <input type="text" class="form-control" id="editTenCuahang" required>
                </div>
                <div class="form-group">
                    <label for="editLinkCMND">Link CMND</label>
                    <input type="text" class="form-control" id="editLinkCMND" required>
                </div>
                <div class="form-group">
                    <label for="editLinkHopDong">Link Hợp đồng</label>
                    <input type="text" class="form-control" id="editLinkHopDong" required>
                </div>
                <div class="form-group">
                    <label for="editTrangThai">Trạng thái</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="editTrangThai" id="editTrangThaiActive"
                            value="1">
                        <label class="form-check-label" for="editTrangThaiActive">Active</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="editTrangThai" id="editTrangThaiInactive"
                            value="0">
                        <label class="form-check-label" for="editTrangThaiInactive">Inactive</label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                <button type="button" class="btn btn-secondary ml-2" onclick="cancelEdit()">Hủy bỏ</button>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Function to fetch and display data in a table
        async function fetchData() {
            const response = await fetch('https://6605116c2ca9478ea17f2d5d.mockapi.io/tenduongdanang/tracking');
            const data = await response.json();

            const trackingTable = document.getElementById('trackingTable');
            trackingTable.innerHTML = `
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Tên cửa hàng</th>
              <th scope="col">Link CMND</th>
              <th scope="col">Link Hợp đồng</th>
              <th scope="col">Trạng thái</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="trackingTableBody">
          </tbody>
        </table>
      `;

            const tableBody = document.getElementById('trackingTableBody');
            tableBody.innerHTML = '';

            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
          <td>${item.Tencuahang}</td>
          <td><a href="${item.LinkCMND}" target="_blank">${item.Tencuahang}</a></td>
      <td><a href="${item.LinkHopDong}" target="_blank">${item.LinkHopDong}</a></td>
          <td>${item.trangthai === 1 ? 'Đã Ký' : 'Chưa Thành Công'}</td>
          <td>
            <button onclick="editItem('${item.id}')" class="btn btn-primary btn-sm">Edit</button>
            <button onclick="deleteItem('${item.id}')" class="btn btn-danger btn-sm">Delete</button>
          </td>
        `;
                tableBody.appendChild(tr);
            });
        }

        // Initial fetch when the page loads
        fetchData();

        // Function to delete an item
        async function deleteItem(id) {
            if (confirm('Bạn có chắc chắn muốn xóa mục này?')) {
                try {
                    const response = await fetch(`https://6605116c2ca9478ea17f2d5d.mockapi.io/tenduongdanang/tracking/${id}`, {
                        method: 'DELETE'
                    });
                    if (response.ok) {
                        alert('Xóa thành công!');
                        fetchData(); // Refresh the table after deletion
                    } else {
                        throw new Error('Xóa không thành công');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Đã có lỗi xảy ra khi xóa dữ liệu.');
                }
            }
        }

        // Function to edit an item
        async function editItem(id) {
            // Fetch item details by id
            const response = await fetch(`https://6605116c2ca9478ea17f2d5d.mockapi.io/tenduongdanang/tracking/${id}`);
            const data = await response.json();

            // Fill the edit form with current item data
            document.getElementById('editItemId').value = id;
            document.getElementById('editTenCuahang').value = data.Tencuahang;
            document.getElementById('editLinkCMND').value = data.LinkCMND;
            document.getElementById('editLinkHopDong').value = data.LinkHopDong;
            if (data.trangthai === 1) {
                document.getElementById('editTrangThaiActive').checked = true;
            } else {
                document.getElementById('editTrangThaiInactive').checked = true;
            }

            // Show the edit form
            document.getElementById('editForm').style.display = 'block';
        }

        // Function to handle edit form submission
        document.getElementById('editTrackingForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const id = document.getElementById('editItemId').value;
            const formData = {
                Tencuahang: document.getElementById('editTenCuahang').value,
                LinkCMND: document.getElementById('editLinkCMND').value,
                LinkHopDong: document.getElementById('editLinkHopDong').value,
                trangthai: parseInt(document.querySelector('input[name="editTrangThai"]:checked').value)
            };

            try {
                const response = await fetch(`https://6605116c2ca9478ea17f2d5d.mockapi.io/tenduongdanang/tracking/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });
                if (response.ok) {
                    alert('Cập nhật thành công!');
                    fetchData(); // Refresh the table after update
                    document.getElementById('editForm').style.display = 'none'; // Hide edit form after successful update
                } else {
                    throw new Error('Cập nhật không thành công');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Đã có lỗi xảy ra khi cập nhật dữ liệu.');
            }
        });

        // Function to cancel editing
        function cancelEdit() {
            document.getElementById('editForm').style.display = 'none';
        }
    </script>
</body>

</html>